<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SpringBootInit25 &#8212; iss24 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css?v=34905f61" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=87712ff3" />
    <script src="_static/documentation_options.js?v=f2a433a1"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">iss24 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">SpringBootInit25</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="springbootinit25">
<h1>SpringBootInit25<a class="headerlink" href="#springbootinit25" title="Link to this heading">¶</a></h1>
<p>Lo sviluppo di una <a class="reference external" href="https://it.wikipedia.org/wiki/Applicazione_web">Applicazione web</a>&gt; non può prescindere dall’uso di uno dei numerosi
framework disponibili, come ad esempio il framework <cite>SpringBoot</cite>&gt; cui facciamo riferikmento in questo documento.</p>
<p><span class="remark">Domanda a ChatGpt</span>: Vorrei un sommario dei motivi per cui il framework SpringBoot risulta utile per lo sviluppo di Web application in Java e la moderna costruzione di microservizi</p>
<p><span class="slide2">Risposta</span></p>
<p>Spring Boot è un framework che semplifica lo sviluppo di applicazioni web e microservizi in Java. Di seguito sono elencati i principali motivi per cui è ampiamente utilizzato:</p>
<ol class="arabic simple">
<li><p><strong>Configurazione Automatica</strong>
- Spring Boot fornisce la configurazione automatica (<cite>Spring Boot Auto Configuration</cite>) riducendo la necessità di configurazioni manuali.</p></li>
<li><p><strong>Standalone e Pronto all’Uso</strong>
- Integra un server embedded (Tomcat, Jetty, Undertow) eliminando la necessità di configurare un server esterno.</p></li>
<li><p><strong>Semplice Configurazione con Spring Boot Starter</strong>
- Fornisce starter preconfigurati per componenti comuni (<cite>spring-boot-starter-web</cite>, <cite>spring-boot-starter-data-jpa</cite>, ecc.).</p></li>
<li><p><strong>Microservizi e Scalabilità</strong>
- Supporta l’architettura a microservizi con componenti come Spring Cloud per la gestione della configurazione, discovery service e resilienza.</p></li>
<li><p><strong>Monitoraggio e Metriche</strong>
- Offre strumenti integrati per il monitoraggio (<cite>Spring Boot Actuator</cite>) con endpoint pronti per l’uso per il debugging e le metriche di sistema.</p></li>
<li><p><strong>Sicurezza Integrata</strong>
- Facile integrazione con Spring Security per autenticazione e autorizzazione.</p></li>
<li><p><strong>Gestione delle Dipendenze Semplificata</strong>
- Usa Maven o Gradle con dipendenze gestite per evitare conflitti tra librerie.</p></li>
<li><p><strong>Facilità di Test</strong>
- Supporta test unitari e di integrazione con strumenti come JUnit, Mockito e Testcontainers.</p></li>
<li><p><strong>Supporto per Container e Cloud-Native</strong>
- Ideale per il deploy in container Docker e orchestratori come Kubernetes.</p></li>
<li><p><strong>Comunità Attiva e Documentazione Estesa</strong>
- Ampia comunità e documentazione dettagliata rendono lo sviluppo più semplice e veloce.</p></li>
</ol>
<p>Spring Boot è quindi una scelta eccellente per sviluppare applicazioni moderne, scalabili e facilmente mantenibili.</p>
<p><span class="remark">Domanda a ChatGpt</span>:
Vorrei un esempio di codice Java (e JavaScript) che usa SpringBoot per rendere disponibile una pagina HMTL con un pulsante START e che usa le websocket per aggiornare dinamicante la pagina con informazioni inviate dal server</p>
<p><span class="slide2">Risposta</span></p>
<p>Questo esempio mostra come utilizzare <strong>Spring Boot</strong> per servire una pagina HTML con un pulsante “START” e <strong>WebSockets</strong> per inviare aggiornamenti dal server al client.</p>
<section id="backend-java-spring-boot">
<h2>Backend (Java - Spring Boot)<a class="headerlink" href="#backend-java-spring-boot" title="Link to this heading">¶</a></h2>
<p>### 1. Dipendenze (<cite>build.gradle</cite>)
Aggiungi le seguenti dipendenze in <cite>build.gradle</cite>:</p>
<div class="highlight-groovy notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="s1">&#39;org.springframework.boot&#39;</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s1">&#39;3.1.0&#39;</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="s1">&#39;io.spring.dependency-management&#39;</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="s1">&#39;1.1.0&#39;</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="s1">&#39;java&#39;</span>
<span class="o">}</span>

<span class="n">dependencies</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="s1">&#39;org.springframework.boot:spring-boot-starter-web&#39;</span>
<span class="w">    </span><span class="n">implementation</span><span class="w"> </span><span class="s1">&#39;org.springframework.boot:spring-boot-starter-websocket&#39;</span>
<span class="w">    </span><span class="n">developmentOnly</span><span class="w"> </span><span class="s1">&#39;org.springframework.boot:spring-boot-devtools&#39;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>### 2. Configurazione WebSocket (<cite>WebSocketConfig.java</cite>)</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.context.annotation.Configuration</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.socket.config.annotation.EnableWebSocket</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.socket.config.annotation.WebSocketConfigurer</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry</span><span class="p">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@EnableWebSocket</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebSocketConfig</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebSocketConfigurer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">registerWebSocketHandlers</span><span class="p">(</span><span class="n">WebSocketHandlerRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="na">addHandler</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MyWebSocketHandler</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;/ws&quot;</span><span class="p">).</span><span class="na">setAllowedOrigins</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>### 3. WebSocket Handler (<cite>MyWebSocketHandler.java</cite>)</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.socket.TextMessage</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.socket.WebSocketSession</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.socket.handler.TextWebSocketHandler</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.Executors</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.ScheduledExecutorService</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.util.concurrent.TimeUnit</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyWebSocketHandler</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">TextWebSocketHandler</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterConnectionEstablished</span><span class="p">(</span><span class="n">WebSocketSession</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ScheduledExecutorService</span><span class="w"> </span><span class="n">executor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newScheduledThreadPool</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">        </span><span class="n">executor</span><span class="p">.</span><span class="na">scheduleAtFixedRate</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">sendUpdate</span><span class="p">(</span><span class="n">session</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendUpdate</span><span class="p">(</span><span class="n">WebSocketSession</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">session</span><span class="p">.</span><span class="na">sendMessage</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TextMessage</span><span class="p">(</span><span class="s">&quot;Aggiornamento dal server: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>### 4. Controller per Servire la Pagina HTML (<cite>WebController.java</cite>)</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.stereotype.Controller</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="p">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebController</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">home</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;index&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="frontend-html-javascript">
<h2>Frontend (HTML + JavaScript)<a class="headerlink" href="#frontend-html-javascript" title="Link to this heading">¶</a></h2>
<p>Salva questo file in <cite>src/main/resources/templates/index.html</cite>.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;it&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>WebSocket con Spring Boot<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="w">        </span><span class="nt">body</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">font-family</span><span class="p">:</span><span class="w"> </span><span class="n">Arial</span><span class="p">,</span><span class="w"> </span><span class="kc">sans-serif</span><span class="p">;</span><span class="w"> </span><span class="k">text-align</span><span class="p">:</span><span class="w"> </span><span class="kc">center</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">#</span><span class="nn">messages</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">margin-top</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="kt">px</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>WebSocket con Spring Boot<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;startBtn&quot;</span><span class="p">&gt;</span>START<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;messages&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">socket</span><span class="p">;</span>
<span class="w">        </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;startBtn&quot;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">socket</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">socket</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">.</span><span class="nx">OPEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">(</span><span class="s2">&quot;ws://localhost:8080/ws&quot;</span><span class="p">);</span>

<span class="w">                </span><span class="nx">socket</span><span class="p">.</span><span class="nx">onopen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Connessione WebSocket aperta&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="p">};</span>

<span class="w">                </span><span class="nx">socket</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="kd">let</span><span class="w"> </span><span class="nx">messageDiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;div&quot;</span><span class="p">);</span>
<span class="w">                    </span><span class="nx">messageDiv</span><span class="p">.</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="w">                    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;messages&quot;</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">messageDiv</span><span class="p">);</span>
<span class="w">                </span><span class="p">};</span>

<span class="w">                </span><span class="nx">socket</span><span class="p">.</span><span class="nx">onclose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Connessione WebSocket chiusa&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="p">};</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="esecuzione">
<h2>Esecuzione<a class="headerlink" href="#esecuzione" title="Link to this heading">¶</a></h2>
<ol class="arabic">
<li><p><strong>Compila ed esegui il progetto Spring Boot</strong> con il comando:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>./gradlew<span class="w"> </span>bootRun
</pre></div>
</div>
</li>
<li><p><strong>Apri il browser</strong> e vai su <cite>http://localhost:8080/</cite>.</p></li>
<li><p><strong>Clicca il pulsante “START”</strong> per iniziare a ricevere aggiornamenti in tempo reale dal server.</p></li>
</ol>
</section>
<section id="funzionamento">
<h2>Funzionamento<a class="headerlink" href="#funzionamento" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Il backend Spring Boot configura un server WebSocket.</p></li>
<li><p>Quando un client si connette, il server invia aggiornamenti ogni 2 secondi.</p></li>
<li><p>Il frontend HTML + JavaScript crea una connessione WebSocket e aggiorna la pagina con i messaggi ricevuti.</p></li>
</ul>
<p>Questo è un esempio base ma estendibile per casi d’uso reali come notifiche, chat o dashboard live. 🚀</p>
<section id="primi-passi-con-springboot">
<h3>Primi passi con SpringBoot<a class="headerlink" href="#primi-passi-con-springboot" title="Link to this heading">¶</a></h3>
<p><span class="slide3">progetto conwaygui</span>  <a class="reference external" href="../../../../conwaygui">conwaygui</a></p>
<p><span class="slide1">Usiamo Spring initializr</span></p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/conwayguiInit.PNG"><img alt="_images/conwayguiInit.PNG" class="align-center" src="_images/conwayguiInit.PNG" style="width: 100%;" />
</a>
</div></blockquote>
<ol class="arabic simple">
<li><p>Connettersi a <a class="reference external" href="https://start.spring.io/">https://start.spring.io/</a></p></li>
<li><p>Selezionare <code class="docutils literal notranslate"><span class="pre">Gradle-Groovy</span></code>, <code class="docutils literal notranslate"><span class="pre">Java</span></code>, <code class="docutils literal notranslate"><span class="pre">3.4.2</span></code> Group= <code class="docutils literal notranslate"><span class="pre">unibo.disi</span></code>, Artifact= <code class="docutils literal notranslate"><span class="pre">conwaygui</span></code> (Options:Packaging=``Jar``,
Java = <code class="docutils literal notranslate"><span class="pre">17</span></code> ) e le seguenti Dipendenze:</p>
<ul class="simple">
<li><p><span class="blue">Spring Web</span>: crea applicazioni Web, inclusi RESTful, utilizzando Spring MVC. Utilizza Apache Tomcat come contenitore incorporato predefinito.</p></li>
<li><p><span class="blue">Thymeleaf</span>: <a class="reference external" href="https://www.thymeleaf.org/">Thymeleaf</a> è un moderno motore di template Java lato server per ambienti web e standalone,
che mira a fornire un modo elegante e altamente gestibile per creare modelli.
Consente di visualizzare correttamente l’HTML nei browser e come prototipi statici.</p></li>
<li><p><span class="blue">WebSocket</span>: per l’uso delle WebSocket in Spring.</p></li>
<li><p><span class="blue">Spring Boot DevTools</span>: Fornisce riavvii rapidi delle applicazioni, LiveReload e configurazioni per un’esperienza di sviluppo avanzata.
Accelera questo ciclo di aggiornamento (codifica di una modifica, riavvio dell’applicazione e aggiornamento del browser
per visualizzare la modifica).</p></li>
</ul>
</li>
<li><p>Attivare <strong>Generate</strong></p></li>
<li><p>Decomprimiere il file generato <code class="docutils literal notranslate"><span class="pre">conwaygui.zip</span></code> nella directory di lavoro di <em>ISS25</em></p></li>
</ol>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Risultato della decompressione:</p>
<a class="reference internal image-reference" href="_images/conwayguiInitDirs.png"><img alt="_images/conwayguiInitDirs.png" class="align-center" src="_images/conwayguiInitDirs.png" style="width: 100%;" />
</a>
</td>
<td><p>file <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plugins</span> <span class="p">{</span>
    <span class="nb">id</span> <span class="s1">&#39;java&#39;</span>
    <span class="nb">id</span> <span class="s1">&#39;org.springframework.boot&#39;</span> <span class="n">version</span> <span class="s1">&#39;3.4.2&#39;</span>
    <span class="nb">id</span> <span class="s1">&#39;io.spring.dependency-management&#39;</span> <span class="n">version</span> <span class="s1">&#39;1.1.7&#39;</span>
<span class="p">}</span>

<span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;unibo.disi&#39;</span>
<span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;0.0.1-SNAPSHOT&#39;</span>

<span class="n">java</span> <span class="p">{</span>
    <span class="n">toolchain</span> <span class="p">{</span>
        <span class="n">languageVersion</span> <span class="o">=</span> <span class="n">JavaLanguageVersion</span><span class="o">.</span><span class="n">of</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">repositories</span> <span class="p">{</span>
    <span class="n">mavenCentral</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">dependencies</span> <span class="p">{</span>
    <span class="n">implementation</span> <span class="s1">&#39;org.springframework.boot:spring-boot-starter-thymeleaf&#39;</span>
    <span class="n">implementation</span> <span class="s1">&#39;org.springframework.boot:spring-boot-starter-web&#39;</span>
    <span class="n">implementation</span> <span class="s1">&#39;org.springframework.boot:spring-boot-starter-websocket&#39;</span>
    <span class="n">developmentOnly</span> <span class="s1">&#39;org.springframework.boot:spring-boot-devtools&#39;</span>
    <span class="n">testImplementation</span> <span class="s1">&#39;org.springframework.boot:spring-boot-starter-test&#39;</span>
    <span class="n">testRuntimeOnly</span> <span class="s1">&#39;org.junit.platform:junit-platform-launcher&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="progetto-conwaygui">
<h2>Progetto conwaygui<a class="headerlink" href="#progetto-conwaygui" title="Link to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Aprire un IDE e aprire o importare il progetto <a class="reference external" href="../../../../conwaygui">conwaygui</a>.
Osservare la classe generata <code class="docutils literal notranslate"><span class="pre">unibo.disi.conwaygui.ConwayguiApplication.java</span></code></p>
<blockquote>
<div><div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">unibo.disi.conwaygui</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.SpringApplication</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="p">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ConwayguiApplication</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">ConwayguiApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>esegure</p>
<p><code class="docutils literal notranslate"><span class="pre">gradlew</span> <span class="pre">build</span></code></p>
</li>
<li><p>Eseguire l’applicazione (<code class="docutils literal notranslate"><span class="pre">gradlew</span> <span class="pre">bootrun</span></code>) e aprire un browser su  <code class="docutils literal notranslate"><span class="pre">localhost:8080</span></code>: compare la pagina che segue:</p>
<a class="reference internal image-reference" href="_images/springboot1.PNG"><img alt="_images/springboot1.PNG" class="align-center" src="_images/springboot1.PNG" style="width: 50%;" />
</a>
</li>
</ol>
<section id="verso-una-prima-applicazione">
<h3>Verso una prima applicazione<a class="headerlink" href="#verso-una-prima-applicazione" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><p>Creare il file <code class="docutils literal notranslate"><span class="pre">conwaygui\src\main\resources\templates\welcome.html</span></code> con il seguente contenuto:</p>
<div class="highlight-Html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Welcome<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome (in templates)<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Welcome to <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${arg}&quot;</span><span class="p">&gt;</span>Our Arg<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><span class="slide2">th:</span>: <a class="reference external" href="https://www.thymeleaf.org/">Thymeleaf</a>  sostituisce  il valore risultante dalla valutazione di <span class="blue">${arg}</span>
durante l’elaborazione del modello della pagina.</p>
</li>
<li><p>Inserire nel file <code class="docutils literal notranslate"><span class="pre">conwaygui\src\main\resources\application.properties</span></code> quanto segue:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spring</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">conwaygui</span>

<span class="n">spring</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">location</span><span class="o">=</span><span class="n">classpath</span><span class="p">:</span><span class="n">banner</span><span class="o">.</span><span class="n">txt</span>
<span class="n">server</span><span class="o">.</span><span class="n">port</span>   <span class="o">=</span> <span class="mi">8085</span>
</pre></div>
</div>
</li>
<li><p>Inserire nella <code class="docutils literal notranslate"><span class="pre">directory</span> <span class="pre">resources</span></code> un file <code class="docutils literal notranslate"><span class="pre">banner.txt</span></code>  personalizzato ( si veda <a class="reference external" href="https://manytools.org/hacker-tools/ascii-banner/">BannerTool</a>, Font <code class="docutils literal notranslate"><span class="pre">Small</span></code>).</p></li>
</ol>
<p><span class="slide2">Un primo controller</span></p>
</section>
</section>
<section id="hicontrollerdemo">
<h2>HIControllerDemo<a class="headerlink" href="#hicontrollerdemo" title="Link to this heading">¶</a></h2>
<p>Per introdurre un primo controller, creiamo (nel package <code class="docutils literal notranslate"><span class="pre">unibo.disi.conwaygui</span></code>) un file <a class="reference external" href="../../../../conwaygui/src/main/java/unibo/conwaygui/HIControllerDemo.java">HIControllerDemo.java</a> con il seguente contenuto:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">unibo</span><span class="o">.</span><span class="n">conwaygui</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">...</span>

<span class="nd">@Controller</span> <span class="o">//</span><span class="n">ANNOTAZIONE</span> <span class="n">IMPORTANTE</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">HIControllerDemo</span> <span class="p">{</span>
<span class="nd">@Value</span><span class="p">(</span><span class="s2">&quot;$</span><span class="si">{spring.application.name}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">String</span> <span class="n">appName</span><span class="p">;</span>

<span class="nd">@GetMapping</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="n">public</span> <span class="n">String</span> <span class="n">homePage</span><span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">model</span><span class="o">.</span><span class="n">addAttribute</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">,</span> <span class="n">appName</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">&quot;welcome&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Attiviamo di nuovo l’applicazione e un browser su <code class="docutils literal notranslate"><span class="pre">localhost:8085</span></code>. Vedremo comparire:</p>
<a class="reference internal image-reference" href="_images/springboot25-2.PNG"><img alt="_images/springboot25-2.PNG" class="align-center" src="_images/springboot25-2.PNG" style="width: 60%;" />
</a>
<p><span class="slide1">Usiamo le WebSocket</span></p>
<section id="springbootwebsocket">
<h3>SpringBootWebSocket<a class="headerlink" href="#springbootwebsocket" title="Link to this heading">¶</a></h3>
<p>Come primo semplice esempio di uso di <a class="reference internal" href="unibo.basicomm23.html#id1"><span class="std std-ref">Websocket</span></a> in Spring, creiamo una applicazione che consente
a un client di utilizzare un browser per inviare un messaggio o una immagine a un server
che provvede a visualizzare il messaggio o l’immagine presso tutti i client collegati.</p>
</section>
</section>
<section id="usare-le-websocket-in-springboot">
<span id="setupnostomp"></span><h2>Usare le WebSocket in SpringBoot<a class="headerlink" href="#usare-le-websocket-in-springboot" title="Link to this heading">¶</a></h2>
<p>Con riferimento al progetto <a class="reference internal" href="#progetto-conwaygui"><span class="std std-ref">Progetto conwaygui</span></a> inseriamo nel file <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> la seguente dipendenza:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">repositories</span> <span class="p">{</span>
     <span class="n">mavenCentral</span><span class="p">()</span>
     <span class="n">flatDir</span> <span class="p">{</span> <span class="n">dirs</span> <span class="s1">&#39;../unibolibs&#39;</span> <span class="p">}</span>
 <span class="p">}</span>

<span class="n">dependencies</span> <span class="p">{</span>
 <span class="o">...</span>
 <span class="o">//</span><span class="n">Added</span> <span class="k">for</span> <span class="n">WebSocket</span>
 <span class="n">implementation</span> <span class="s1">&#39;org.springframework.boot:spring-boot-starter-websocket&#39;</span>
 <span class="o">//</span><span class="n">JSON</span>
  <span class="n">implementation</span> <span class="s1">&#39;com.googlecode.json-simple:json-simple:1.1.1&#39;</span>
 <span class="o">//</span><span class="n">CUSTOM</span> <span class="n">unibo</span>
     <span class="n">implementation</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;unibo.basicomm23-1.0&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="slide2">Operiamo senza un Controller</span></p>
<ul class="simple">
<li><p>Inseriamo un file <code class="docutils literal notranslate"><span class="pre">index.html</span></code> in <strong>resources/static</strong> per poter lanciare un’applicazione che
presenta un’<em>area  di ouput</em> per la visualizzazione di messaggi e un’<em>area di input</em> per la loro
immissione.</p></li>
</ul>
</section>
<section id="il-file-static-index-html">
<span id="index"></span><h2>Il file static/index.html<a class="headerlink" href="#il-file-static-index-html" title="Link to this heading">¶</a></h2>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">static</span><span class="o">/</span><span class="n">index</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Welcome</span> <span class="ow">in</span> <span class="n">static</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">textarea</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;messageArea&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;messageArea&quot;</span> <span class="n">rows</span><span class="o">=</span><span class="s2">&quot;10&quot;</span> <span class="n">cols</span><span class="o">=</span><span class="s2">&quot;60&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">textarea</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">Type</span> <span class="n">a</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">hit</span> <span class="n">send</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;inputmessage&quot;</span><span class="o">/&gt;&lt;</span><span class="n">button</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;sendMessage&quot;</span><span class="o">&gt;</span><span class="n">Send</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;wsminimal.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p>In questo caso, l’applicazione funzionerà anche senza la introduzione di un Controller,
in quanto Spring utilizza di default il file <code class="docutils literal notranslate"><span class="pre">resources/static/index.html</span></code>.</p>
<p>Per fare una prova, <span class="remark">commentiamo l’annotazione &#64;Controller</span> in <a class="reference internal" href="#hicontrollerdemo"><span class="std std-ref">HIControllerDemo</span></a>,
rilanciamo l’applicazione e  apriamo su un browser con <code class="docutils literal notranslate"><span class="pre">localhost:8085</span></code>.</p>
</li>
</ul>
<p>La pagina si presenta come segue:</p>
<a class="reference internal image-reference" href="_images/pageMinimal.PNG"><img alt="_images/pageMinimal.PNG" class="align-center" src="_images/pageMinimal.PNG" style="width: 50%;" />
</a>
<p>Se invece è presente il controller <a class="reference internal" href="#hicontrollerdemo"><span class="std std-ref">HIControllerDemo</span></a>, allora apriamo in un browser la pagina
<code class="docutils literal notranslate"><span class="pre">http://localhost:8085/index.html</span></code>.</p>
<p><span class="slide1">Funzioni JS nella pagina</span></p>
</section>
<section id="lo-script-wsminimal-js">
<span id="wsminimal"></span><h2>Lo script wsminimal.js<a class="headerlink" href="#lo-script-wsminimal-js" title="Link to this heading">¶</a></h2>
<p>Lo script  <code class="docutils literal notranslate"><span class="pre">resource/static/wsminimal.js</span></code> definisce funzioni che realizzano la connessione con il server
e funzioni di <code class="docutils literal notranslate"><span class="pre">I/O</span></code> che permettono di inviare un messaggio al server e di visualizzare la risposta.</p>
<p><span class="slide2">Funzioni per inviare e ricevere</span></p>
<ul class="simple">
<li><p><em>connect</em>: effettua una connessione alla WebSocket e riceve i messaggi inviati dal server.</p></li>
</ul>
<div class="highlight-js notranslate" id="connect"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">connect</span><span class="p">();</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">connect</span><span class="p">(){</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">host</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">host</span><span class="p">;</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">pathname</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">addr</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ws://&quot;</span><span class="w"> </span><span class="o">+</span><span class="nx">host</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">pathname</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;socket&quot;</span><span class="w">  </span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Assicura che sia aperta un unica connessione</span>
<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="nx">socket</span><span class="o">!==</span><span class="kc">undefined</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">socket</span><span class="p">.</span><span class="nx">readyState</span><span class="o">!==</span><span class="nx">WebSocket</span><span class="p">.</span><span class="nx">CLOSED</span><span class="p">){</span>
<span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;WARNING: Connessione WebSocket già stabilita&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nx">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">WebSocket</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span><span class="w"> </span><span class="c1">//CONNESSIONE</span>

<span class="w">  </span><span class="nx">socket</span><span class="p">.</span><span class="nx">onopen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">addMessageToWindow</span><span class="p">(</span><span class="s2">&quot;Connected&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="nx">socket</span><span class="p">.</span><span class="nx">onmessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//RICEZIONE</span>
<span class="w">    </span><span class="nx">addMessageToWindow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="sb">`</span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">socket</span><span class="p">;</span>
<span class="p">}</span><span class="c1">//connect</span>
</pre></div>
</div>
<p><span class="slide2">Funzioni per aggiornare</span></p>
<ul class="simple" id="sendmessage">
<li><p><em>sendMessage</em>: invia un messaggio al server attraverso la socket</p></li>
<li><p><em>addMessageToWindow</em> : visualizza un messaggio nella output area</p></li>
</ul>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">messageWindow</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;messageArea&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">messageInput</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;inputmessage&quot;</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">sendButton</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;sendMessage&quot;</span><span class="p">);</span>

<span class="nx">sendButton</span><span class="p">.</span><span class="nx">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">messageInput</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="w">    </span><span class="nx">messageInput</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">jsonMsg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="o">:</span><span class="w"> </span><span class="nx">message</span><span class="p">});</span>
<span class="w">    </span><span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">addMessageToWindow</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">messageWindow</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">message</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;\n&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="slide1">Implementiamo WebSocketConfigurer</span></p>
</section>
<section id="configurazione-con-websocketconfigurer">
<h2>Configurazione con WebSocketConfigurer<a class="headerlink" href="#configurazione-con-websocketconfigurer" title="Link to this heading">¶</a></h2>
<p>Affinché l’applicazione Spring inoltri le richieste di un client al server,
è necessario registrare un gestore utilizzando una classe di configurazione
che implementa l’interfaccia <code class="docutils literal notranslate"><span class="pre">WebSocketConfigurer</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSocket</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebSocketConfiguration</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">WebSocketConfigurer</span><span class="w"> </span><span class="p">{</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">WebSocketHandlerDemo</span><span class="w"> </span><span class="n">wshandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WebSocketHandlerDemo</span><span class="p">();</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">wspath</span><span class="w">                  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;socket&quot;</span><span class="p">;</span>
<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">registerWebSocketHandlers</span><span class="p">(</span><span class="n">WebSocketHandlerRegistry</span><span class="w"> </span><span class="n">registry</span><span class="p">){</span>
<span class="w">    </span><span class="n">registry</span><span class="p">.</span><span class="na">addHandler</span><span class="p">(</span><span class="n">wshandler</span><span class="p">,</span><span class="w"> </span><span class="n">wspath</span><span class="p">).</span><span class="na">setAllowedOrigins</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>L’annotazione <code class="docutils literal notranslate"><span class="pre">&#64;EnableWebSocket</span></code> (da aggiungere a una classe qualificata <code class="docutils literal notranslate"><span class="pre">&#64;Configuration</span></code>)
abilita l’uso delle plain WebSocket.</p>
<p>In base alla configurazione <span class="remark">wspath=”socket”</span> trasferita in fase di registrazione dell’handler
<a class="reference internal" href="#il-gestore-websockethandlerdemo"><span class="std std-ref">WebSocketHandlerDemo</span></a>, il server, avvalendosi di una istanza di <code class="docutils literal notranslate"><span class="pre">WebSocketHandler</span></code>,
risponderà a richieste inviate al seguente indirizzo:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nl">ws</span><span class="p">:</span><span class="c1">//&lt;serverIP&gt;:8085/socket</span>
</pre></div>
</div>
<p><span class="slide1">Definiamo il gestore dei messaggi</span></p>
</section>
<section id="il-gestore-websockethandlerdemo">
<h2>Il gestore WebSocketHandlerDemo<a class="headerlink" href="#il-gestore-websockethandlerdemo" title="Link to this heading">¶</a></h2>
<p>La classe  <code class="docutils literal notranslate"><span class="pre">WebSocketHandlerDemo</span></code> definisce un gestore custom di messaggi come specializzazione della classe astratta
<code class="docutils literal notranslate"><span class="pre">org.springframework.web.socket.handler.AbstractWebSocketHandler</span></code>
(o delle sue sottoclassi <code class="docutils literal notranslate"><span class="pre">TextWebSocketHandler</span></code> o <code class="docutils literal notranslate"><span class="pre">BinaryWebSocketHandler</span></code>).</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebSocketHandlerDemo</span>
<span class="w">    </span><span class="kd">extends</span><span class="w"> </span><span class="n">AbstractWebSocketHandler</span><span class="w"> </span><span class="p">{</span><span class="c1">//che implements WebSocketHandler interface</span>

<span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">WebSocketSession</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sessions</span><span class="o">=</span><span class="k">new</span><span class="w"> </span><span class="n">CopyOnWriteArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p><span class="slide2">Propaghiamo l’informazione dal server ai client</span></p>
</section>
<section id="propagazione-a-tutti-i-client">
<h2>Propagazione a tutti i client<a class="headerlink" href="#propagazione-a-tutti-i-client" title="Link to this heading">¶</a></h2>
<p>Per propagare un messaggio a tutti i client connessi attraverso la WebSocket, basta tenere traccia
delle sessioni.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span><span class="w">  </span><span class="c1">//AbstractWebSocketHandler</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterConnectionEstablished</span><span class="p">(</span><span class="n">WebSocketSession</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">{</span>
<span class="w">    </span><span class="n">sessions</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
<span class="w">    </span><span class="kd">super</span><span class="p">.</span><span class="na">afterConnectionEstablished</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
<span class="p">}</span>
<span class="nd">@Override</span><span class="w"> </span><span class="c1">//AbstractWebSocketHandler</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">afterConnectionClosed</span><span class="p">(</span><span class="w"> </span><span class="n">WebSocketSession</span><span class="w"> </span><span class="n">session</span><span class="p">,</span>
<span class="w">                        </span><span class="n">CloseStatus</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">{</span>
<span class="w">    </span><span class="n">sessions</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
<span class="w">    </span><span class="kd">super</span><span class="p">.</span><span class="na">afterConnectionClosed</span><span class="p">(</span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Nel nostro caso, la gestione del messaggio ricevuto
consiste nel reinviare sulla WebSocket il messaggio stesso.
Questa azione del server porrà in esecuzione sul client  l’operazione <code class="docutils literal notranslate"><span class="pre">socket.onmessage</span></code>
(si veda <a class="reference internal" href="#connect">connect</a>) che visualizzerà il messaggio nell’area di output.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span><span class="w"> </span><span class="c1">//AbstractWebSocketHandler</span>
<span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleTextMessage</span><span class="p">(</span><span class="n">WebSocketSession</span><span class="w"> </span><span class="n">session</span><span class="p">,</span>
<span class="w">                    </span><span class="n">TextMessage</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">{</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">.</span><span class="na">getPayload</span><span class="p">();</span>
<span class="w">    </span><span class="n">sendToAll</span><span class="p">(</span><span class="s">&quot;echo: &quot;</span><span class="o">+</span><span class="n">cmd</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendToAll</span><span class="p">(</span><span class="n">TextMessage</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">{</span>
<span class="w">    </span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">WebSocketSession</span><span class="o">&gt;</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sessions</span><span class="p">.</span><span class="na">iterator</span><span class="p">();</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">iter</span><span class="p">.</span><span class="na">hasNext</span><span class="p">()</span><span class="w"> </span><span class="p">){</span><span class="w"> </span><span class="n">iter</span><span class="p">.</span><span class="na">next</span><span class="p">().</span><span class="na">sendMessage</span><span class="p">(</span><span class="n">message</span><span class="p">);}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="un-client-in-java">
<h2>Un client in Java<a class="headerlink" href="#un-client-in-java" title="Link to this heading">¶</a></h2>
<p>Definiamo un client in Java che usa
<a class="reference internal" href="unibo.basicomm23.html#unibo-basicomm23-utils-connectionfactory"><span class="std std-ref">ConnectionFactory</span></a> per creare una connessione
di tipo <span class="xref std std-ref">WsConnection</span> con il server,
aggiungendo se stesso come osservaore sulla connessione.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>public class TestClient extends ApplAbstractObserver {
    private Interaction2021 clientConn;

    public TestClient(){
        clientConn = ConnectionFactory.createClientSupport(
                ProtocolType.ws, &quot;localhost&quot;, &quot;8085/socket&quot;); //!!! NOTE 8085/socket
        ((WsConnection)clientConn ).addObserver(this);
    }

    @Override
    public void update(String s) {
        CommUtils.outblue(&quot;TestClient update=&quot; + s);
    }

    public void doJob(){
        try {
            clientConn.forward(&quot;hello from Java client&quot;);
            CommUtils.outblue(&quot;TestClient forward done &quot; );
            Thread.sleep(2000); //To sse the update
        } catch (Exception ex) {
            CommUtils.outred(&quot;TestClient ERROR: &quot; + ex.getMessage());
        }
    }
    public static void main(String[] args) {
        TestClient appl = new TestClient();
        appl.doJob();
    }
}
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Attivare l’applicazione Spring <code class="docutils literal notranslate"><span class="pre">conwayguiApplication</span></code> <strong>SENZA Controller</strong></p></li>
<li><p>Aprire un browser su <code class="docutils literal notranslate"><span class="pre">localhost:8085</span></code></p></li>
<li><p>Attivare <code class="docutils literal notranslate"><span class="pre">TestClient</span></code> e osservare l’update  sulla output area della pagina</p></li>
</ol>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">SpringBootInit25</a><ul>
<li><a class="reference internal" href="#backend-java-spring-boot">Backend (Java - Spring Boot)</a></li>
<li><a class="reference internal" href="#frontend-html-javascript">Frontend (HTML + JavaScript)</a></li>
<li><a class="reference internal" href="#esecuzione">Esecuzione</a></li>
<li><a class="reference internal" href="#funzionamento">Funzionamento</a><ul>
<li><a class="reference internal" href="#primi-passi-con-springboot">Primi passi con SpringBoot</a></li>
</ul>
</li>
<li><a class="reference internal" href="#progetto-conwaygui">Progetto conwaygui</a><ul>
<li><a class="reference internal" href="#verso-una-prima-applicazione">Verso una prima applicazione</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hicontrollerdemo">HIControllerDemo</a><ul>
<li><a class="reference internal" href="#springbootwebsocket">SpringBootWebSocket</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usare-le-websocket-in-springboot">Usare le WebSocket in SpringBoot</a></li>
<li><a class="reference internal" href="#il-file-static-index-html">Il file static/index.html</a></li>
<li><a class="reference internal" href="#lo-script-wsminimal-js">Lo script wsminimal.js</a></li>
<li><a class="reference internal" href="#configurazione-con-websocketconfigurer">Configurazione con WebSocketConfigurer</a></li>
<li><a class="reference internal" href="#il-gestore-websockethandlerdemo">Il gestore WebSocketHandlerDemo</a></li>
<li><a class="reference internal" href="#propagazione-a-tutti-i-client">Propagazione a tutti i client</a></li>
<li><a class="reference internal" href="#un-client-in-java">Un client in Java</a></li>
</ul>
</li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/SpringBootInit25.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">iss24 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">SpringBootInit25</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Antonio Natali.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>